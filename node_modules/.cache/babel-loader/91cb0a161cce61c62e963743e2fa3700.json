{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\caoxue\\\\Desktop\\\\secondary\\\\secondary\\\\src\\\\pages\\\\message\\\\messageDetail.js\";\n\n/**\r\n * Created by Lenovo on 2019/9/2.\r\n */\nimport React from 'react';\nimport './message.css';\nimport avatar from '../../images/personal/avatar.jpg';\nimport sale from '../../images/personal/sale.png';\nimport buy from '../../images/personal/buy.png';\nimport modify from '../../images/personal/modify.png';\nimport { Title } from '../../share';\nimport { getData, goNext, getTimeFormat, getTimeHour } from '../../utils';\nexport default class MessageDetail extends React.Component {\n  constructor(props) {\n    super(props);\n    this.item = this.props.history.location.state || {};\n    console.log(this.item);\n    this.count = 0;\n    this.state = {\n      chatList: [],\n      index: 0,\n      value: null\n    };\n  }\n\n  componentDidMount() {\n    this.goLogin();\n    var textarea = document.getElementsByTagName(\"textarea\");\n\n    for (var i = 0; i < textarea.length; i++) {\n      textarea[i].style.height = '0.5rem';\n      textarea[i].scrollTop = 0; //防抖动\n\n      textarea[i].style.height = textarea[i].scrollHeight + 'px';\n      textarea[i].addEventListener('input', function (e) {\n        e.target.style.height = 'auto';\n        e.target.scrollTop = 0; //防抖动\n\n        if (e.target.scrollHeight < 20) {\n          e.target.style.height = '20px';\n        } else {\n          e.target.style.height = e.target.scrollHeight + 'px';\n        }\n      });\n    }\n\n    var user = JSON.parse(localStorage.getItem(\"userInfo\")) || {};\n    var userId = user.userId;\n    console.log(user);\n    this.socket = new WebSocket(\"ws://49.232.24.206:9001/secondary/socket?\" + userId);\n\n    this.socket.onopen = function () {\n      //heartCheck.reset().start(); //心跳检测重置\n      console.log(\"Socket 已打开\");\n    };\n\n    this.socket.onmessage = msg => {\n      console.log(msg);\n\n      if (msg.data.indexOf(\"{\") != -1) {\n        console.log(msg);\n        var obj = JSON.parse(msg.data);\n        this.state.chatList.push({\n          anotherContent: obj.content,\n          time: this.choseTime()\n        });\n        this.setState({\n          index: this.state.index++\n        }); //console.log(obj);\n      }\n    };\n\n    this.socket.onerror = function (err) {\n      console.log(err);\n    };\n  }\n\n  goLogin() {\n    getData({\n      method: 'post',\n      url: 'getChatList',\n      data: {},\n      successCB: res => {\n        console.log(res);\n      }\n    });\n  }\n\n  onLeftClick() {\n    this.props.history.goBack();\n  }\n\n  sendMessage() {\n    var value = this.refs.textarea.value;\n\n    if (!value) {\n      return;\n    }\n\n    this.time = new Date().getTime();\n    this.state.chatList.push({\n      content: value,\n      time: this.choseTime()\n    });\n    this.setState({\n      index: this.state.index++\n    }, function () {\n      this.refs.textarea.value = '';\n    });\n    var user = JSON.parse(localStorage.getItem(\"userInfo\")) || {};\n    var token = localStorage.getItem(\"token\");\n    var data = {\n      \"toUserId\": this.item.anotherUserId,\n      \"toUserName\": this.item.anotherUserName,\n      \"toUserAvatar\": this.item.anotherUserAvatar,\n      \"token\": token,\n      \"content\": value\n    };\n\n    if (this.socket.readyState === 1) {\n      this.socket.send(JSON.stringify(data));\n    } else {//do something\n    }\n  }\n\n  changeState(e) {\n    console.log(e);\n    this.setState({\n      value: e.target.value\n    });\n  }\n\n  choseTime() {\n    var finalTime = getTimeHour(this.time);\n    console.log(new Date().getTime(), this.time + 1000 * 60);\n\n    if (new Date().getTime() > this.time + 1000 * 60) {\n      finalTime = getTimeHour(new Date().getTime());\n    } else {\n      if (this.count > 0) {\n        finalTime = '';\n      }\n    }\n\n    this.count++;\n    return finalTime;\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"cm-mlr-018\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135\n      },\n      __self: this\n    }, React.createElement(Title, {\n      title: this.item.anotherUserName,\n      onLeftClick: this.onLeftClick.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"cm-flex cm-ai-c cm-p-018 cm-bc-white\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      src: this.item.anotherUserAvatar,\n      alt: \"\",\n      className: \"cm-img-06 cm-mr-018\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"cm-c-main cm-fs-024\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140\n      },\n      __self: this\n    }, \"\\uFFE5123\"), React.createElement(\"div\", {\n      className: \"cm-c-999 cm-fs-020 cm-mt-018\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141\n      },\n      __self: this\n    }, \"\\u4EA4\\u6613\\u524D\\u804A\\u4E00\\u804A\"))), this.state.chatList.map((item, index) => {\n      return React.createElement(\"div\", {\n        key: index,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"cm-mar-20-10 cm-flex-column\",\n        key: index,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"cm-tx-c\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 147\n        },\n        __self: this\n      }, item.time), React.createElement(\"div\", {\n        className: \"cm-flex cm-ai-c cm-tx-c cm-as-fe cm-mt-10 detail-ml-30\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"cm-flex\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \" detail-chat-height cm-pad-10 cm-bc-ddd cm-tx-l\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150\n        },\n        __self: this\n      }, item.content), React.createElement(\"div\", {\n        className: \"detail-triangle\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151\n        },\n        __self: this\n      })), React.createElement(\"img\", {\n        src: this.item.anotherUserAvatar,\n        alt: \"\",\n        className: \"cm-img-large cm-as-fs\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"cm-mar-20-10 cm-flex-column\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"cm-tx-c\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157\n        },\n        __self: this\n      }, \"09:45\"), React.createElement(\"div\", {\n        className: \"cm-flex cm-ai-c cm-tx-c cm-as-fs cm-mt-018 detail-mr-30\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        src: this.item.anotherUserAvatar,\n        alt: \"\",\n        className: \"cm-img-large cm-as-fs\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"cm-flex\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"detail-triangle-right\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"detail-chat-height cm-pad-10 cm-bc-white cm-tx-l\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162\n        },\n        __self: this\n      }, item.anotherContent)))));\n    }), React.createElement(\"div\", {\n      className: \"detail-position\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168\n      },\n      __self: this\n    }, React.createElement(\"textarea\", {\n      onChange: e => this.changeState(e),\n      ref: \"textarea\",\n      className: \"msg-detail-textarea\",\n      name: \"\",\n      id: \"\",\n      cols: \"30\",\n      rows: \"1\",\n      placeholder: \"\\u60F3\\u8DDF\\u4ED6\\u8BF4\\u70B9\\u4EC0\\u4E48\\u5462\\uFF1F\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169\n      },\n      __self: this\n    }), React.createElement(\"span\", {\n      className: \"detail-send\",\n      onClick: () => this.sendMessage(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171\n      },\n      __self: this\n    }, \"\\u53D1\\u9001\")));\n  }\n\n}","map":{"version":3,"sources":["C:\\Users\\caoxue\\Desktop\\secondary\\secondary\\src\\pages\\message\\messageDetail.js"],"names":["React","avatar","sale","buy","modify","Title","getData","goNext","getTimeFormat","getTimeHour","MessageDetail","Component","constructor","props","item","history","location","state","console","log","count","chatList","index","value","componentDidMount","goLogin","textarea","document","getElementsByTagName","i","length","style","height","scrollTop","scrollHeight","addEventListener","e","target","user","JSON","parse","localStorage","getItem","userId","socket","WebSocket","onopen","onmessage","msg","data","indexOf","obj","push","anotherContent","content","time","choseTime","setState","onerror","err","method","url","successCB","res","onLeftClick","goBack","sendMessage","refs","Date","getTime","token","anotherUserId","anotherUserName","anotherUserAvatar","readyState","send","stringify","changeState","finalTime","render","bind","map"],"mappings":"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","sourcesContent":["/**\r\n * Created by Lenovo on 2019/9/2.\r\n */\r\nimport React from 'react';\r\nimport './message.css';\r\nimport avatar from '../../images/personal/avatar.jpg';\r\nimport sale from '../../images/personal/sale.png';\r\nimport buy from '../../images/personal/buy.png';\r\nimport modify from '../../images/personal/modify.png';\r\nimport {Title} from '../../share';\r\nimport {getData, goNext, getTimeFormat, getTimeHour} from '../../utils';\r\nexport default class MessageDetail extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.item = this.props.history.location.state || {};\r\n        console.log(this.item);\r\n        this.count = 0;\r\n        this.state = {\r\n            chatList: [],\r\n            index: 0,\r\n            value: null\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.goLogin();\r\n        var textarea = document.getElementsByTagName(\"textarea\");\r\n        for (var i = 0; i < textarea.length; i++) {\r\n            textarea[i].style.height = '0.5rem';\r\n            textarea[i].scrollTop = 0; //防抖动\r\n            textarea[i].style.height = textarea[i].scrollHeight + 'px';\r\n            textarea[i].addEventListener('input', function (e) {\r\n                e.target.style.height = 'auto';\r\n                e.target.scrollTop = 0; //防抖动\r\n                if (e.target.scrollHeight < 20) {\r\n                    e.target.style.height = '20px';\r\n                } else {\r\n                    e.target.style.height = e.target.scrollHeight + 'px';\r\n                }\r\n            })\r\n        }\r\n        var user = JSON.parse(localStorage.getItem(\"userInfo\")) || {};\r\n        var userId = user.userId;\r\n        console.log(user);\r\n        this.socket = new WebSocket(\"ws://49.232.24.206:9001/secondary/socket?\" + userId);\r\n        this.socket.onopen = function () {\r\n            //heartCheck.reset().start(); //心跳检测重置\r\n            console.log(\"Socket 已打开\");\r\n        };\r\n        this.socket.onmessage =  (msg)=> {\r\n            console.log(msg);\r\n            if (msg.data.indexOf(\"{\") != -1) {\r\n                console.log(msg);\r\n                var obj = JSON.parse(msg.data);\r\n                this.state.chatList.push({anotherContent: obj.content, time: this.choseTime()});\r\n                this.setState({\r\n                    index: this.state.index++\r\n                })\r\n                //console.log(obj);\r\n            }\r\n        };\r\n        this.socket.onerror = function (err) {\r\n            console.log(err);\r\n        };\r\n    }\r\n\r\n    goLogin() {\r\n        getData({\r\n            method: 'post',\r\n            url: 'getChatList',\r\n            data: {},\r\n            successCB: (res) => {\r\n                console.log(res);\r\n            }\r\n        })\r\n    }\r\n\r\n    onLeftClick() {\r\n        this.props.history.goBack();\r\n    }\r\n\r\n    sendMessage() {\r\n        var value = this.refs.textarea.value;\r\n        if (!value) {\r\n            return;\r\n        }\r\n        this.time = new Date().getTime();\r\n        this.state.chatList.push({content: value, time: this.choseTime()});\r\n        this.setState({\r\n            index: this.state.index++\r\n        }, function () {\r\n            this.refs.textarea.value = '';\r\n        });\r\n        var user = JSON.parse(localStorage.getItem(\"userInfo\")) || {};\r\n        var token = localStorage.getItem(\"token\");\r\n        var data = {\r\n            \"toUserId\": this.item.anotherUserId,\r\n            \"toUserName\": this.item.anotherUserName,\r\n            \"toUserAvatar\": this.item.anotherUserAvatar,\r\n            \"token\": token,\r\n            \"content\": value,\r\n        };\r\n\r\n        if (this.socket.readyState === 1) {\r\n            this.socket.send(JSON.stringify(data));\r\n        } else {\r\n            //do something\r\n        }\r\n\r\n\r\n    }\r\n\r\n    changeState(e) {\r\n        console.log(e);\r\n        this.setState({\r\n            value: e.target.value\r\n        })\r\n    }\r\n\r\n    choseTime() {\r\n        var finalTime = getTimeHour(this.time);\r\n        console.log((new Date().getTime()), (this.time + 1000 * 60));\r\n        if ((new Date().getTime()) > (this.time + 1000 * 60)) {\r\n            finalTime = getTimeHour(new Date().getTime())\r\n        } else {\r\n            if (this.count > 0) {\r\n                finalTime = '';\r\n            }\r\n        }\r\n        this.count++;\r\n        return finalTime;\r\n    }\r\n\r\n    render() {\r\n        return <div className=\"cm-mlr-018\">\r\n            <Title title={this.item.anotherUserName} onLeftClick={this.onLeftClick.bind(this)}/>\r\n            <div className=\"cm-flex cm-ai-c cm-p-018 cm-bc-white\">\r\n                <img src={this.item.anotherUserAvatar} alt=\"\" className=\"cm-img-06 cm-mr-018\"/>\r\n                <div>\r\n                    <div className=\"cm-c-main cm-fs-024\">￥123</div>\r\n                    <div className=\"cm-c-999 cm-fs-020 cm-mt-018\">交易前聊一聊</div>\r\n                </div>\r\n            </div>\r\n            {this.state.chatList.map((item, index) => {\r\n                return <div key={index}>\r\n                    <div className=\"cm-mar-20-10 cm-flex-column\" key={index}>\r\n                        <div className=\"cm-tx-c\">{item.time}</div>\r\n                        <div className=\"cm-flex cm-ai-c cm-tx-c cm-as-fe cm-mt-10 detail-ml-30\">\r\n                            <div className=\"cm-flex\">\r\n                                <div className=\" detail-chat-height cm-pad-10 cm-bc-ddd cm-tx-l\">{item.content}</div>\r\n                                <div className=\"detail-triangle\"></div>\r\n                            </div>\r\n                            <img src={this.item.anotherUserAvatar} alt=\"\" className=\"cm-img-large cm-as-fs\"/>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"cm-mar-20-10 cm-flex-column\">\r\n                        <div className=\"cm-tx-c\">09:45</div>\r\n                        <div className=\"cm-flex cm-ai-c cm-tx-c cm-as-fs cm-mt-018 detail-mr-30\">\r\n                            <img src={this.item.anotherUserAvatar} alt=\"\" className=\"cm-img-large cm-as-fs\"/>\r\n                            <div className=\"cm-flex\">\r\n                                <div className=\"detail-triangle-right\"></div>\r\n                                <div className=\"detail-chat-height cm-pad-10 cm-bc-white cm-tx-l\">{item.anotherContent}</div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            })}\r\n            <div className=\"detail-position\">\r\n                <textarea onChange={(e) => this.changeState(e)} ref=\"textarea\" className=\"msg-detail-textarea\" name=\"\"\r\n                          id=\"\" cols=\"30\" rows=\"1\" placeholder=\"想跟他说点什么呢？\"></textarea>\r\n                <span className=\"detail-send\"\r\n                      onClick={() => this.sendMessage()}>发送</span>\r\n            </div>\r\n        </div>\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}