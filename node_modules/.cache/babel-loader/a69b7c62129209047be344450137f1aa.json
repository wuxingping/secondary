{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\caoxue\\\\Desktop\\\\secondary\\\\src\\\\pages\\\\message\\\\messageDetail.js\";\n\n/**\r\n * Created by Lenovo on 2019/9/2.\r\n */\nimport React from 'react';\nimport './message.css';\nimport { Title } from '../../share';\nimport { PullToRefresh, ListView } from 'antd-mobile';\nimport ReactDOM from 'react-dom';\nimport { getData, getTimeFormat, getTimeHour, autoTextarea } from '../../utils';\nlet self;\nexport default class MessageDetail extends React.Component {\n  constructor(props) {\n    super(props); //获取从聊天列表页面和商品详情页传过来的参数\n\n    this.onRefresh = () => {\n      if (!this.state.hasMore) {\n        return;\n      }\n\n      this.setState({\n        refreshing: true,\n        isLoading: true\n      }); // simulate initial Ajax\n\n      setTimeout(() => {\n        this.getChatDetailList();\n      }, 600);\n    };\n\n    this.item = this.props.history.location.state || {}; //获取本地缓存的个人信息\n\n    this.user = localStorage.getItem(\"userInfo\") ? JSON.parse(localStorage.getItem(\"userInfo\")) : {}; //初始化聊天记录数据源\n\n    const dataSource = new ListView.DataSource({\n      rowHasChanged: (row1, row2) => row1 !== row2\n    });\n    self = this;\n    this.state = {\n      dataSource,\n      refreshing: true,\n      hasMore: true,\n      isLoading: true,\n      height: document.documentElement.clientHeight,\n      useBodyScroll: false,\n      pageNum: 1,\n      //定义初始化请求序号\n      pageSize: 10,\n      //定义初始化请求数量\n      value: null,\n      isShow: false\n    };\n    this.initData = [];\n  }\n\n  componentDidMount() {\n    var textarea = document.getElementsByTagName(\"input\");\n\n    for (var i = 0; i < textarea.length; i++) {\n      textarea[i].style.height = '0.4rem';\n      textarea[i].scrollTop = 0; //防抖动\n\n      textarea[i].style.height = textarea[i].scrollHeight + 'px';\n      textarea[i].addEventListener('input', function (e) {\n        e.target.style.height = 'auto';\n        e.target.scrollTop = 0; //防抖动\n\n        if (e.target.scrollHeight < 20) {\n          e.target.style.height = '20px';\n        } else {\n          e.target.style.height = e.target.scrollHeight + 'px';\n        }\n      });\n    }\n\n    this.getChatDetailList();\n    var chatList = this.refs.chatList;\n    chatList.addEventListener(\"touchstart\", () => {\n      this.setState({\n        isShow: false\n      });\n    });\n    this.socket = new WebSocket(\"ws://49.232.24.206:9001/secondary/socket?\" + this.user.userId); //心跳检测\n\n    this.heartCheck = {\n      timeout: 60000,\n      //心跳间隔时间，单位ms\n      timeoutObj: null,\n      serverTimeoutObj: null,\n      reset: function () {\n        clearTimeout(this.timeoutObj);\n        clearTimeout(this.serverTimeoutObj);\n        return this;\n      },\n      start: function () {\n        var that = this;\n        this.timeoutObj = setTimeout(function () {\n          console.log(this); //这里发送一个心跳，后端收到后，返回一个心跳消息，\n          //onmessage拿到返回的心跳就说明连接正常\n\n          self.socket.send(\"heartbeat...【\" + self.user.userId + \"】\");\n          that.serverTimeoutObj = setTimeout(function () {\n            //如果超过一定时间还没重置，说明后端主动断开了\n            self.socket.close(); //如果onclose会执行reconnect，我们执行ws.close()就行了.如果直接执行reconnect 会触发onclose导致重连两次\n          }, that.timeout);\n        }, this.timeout);\n      }\n    };\n\n    this.socket.onopen = () => {\n      this.heartCheck.reset().start(); //心跳检测重置\n\n      console.log(\"Socket 已打开\");\n    };\n\n    this.socket.onmessage = msg => {\n      this.heartCheck.reset().start(); //心跳检测重置\n\n      if (msg.data.indexOf(\"{\") != -1) {\n        console.log(msg);\n        var obj = JSON.parse(msg.data);\n        this.initData.push({\n          content: obj.content,\n          type: 'received',\n          time: getTimeHour(new Date().getTime())\n        });\n        this.setState({\n          dataSource: this.state.dataSource.cloneWithRows(this.initData)\n        });\n      }\n    };\n\n    this.socket.onerror = function (err) {\n      console.log(err);\n    };\n  }\n\n  onLeftClick() {\n    this.props.history.goBack();\n  }\n\n  openChat(e) {\n    e.stopPropagation();\n    this.setState({\n      isShow: true\n    }, function () {\n      autoTextarea();\n    });\n  }\n\n  abc(event) {\n    alert(888);\n\n    if (event.keyCode == 13) {\n      //如果按的是enter键 13是enter\n      event.preventDefault(); //禁止默认事件（默认是换行）\n\n      alert(555);\n    }\n  }\n\n  getChatDetailList() {\n    getData({\n      method: 'post',\n      url: 'getChatDetailList',\n      data: {\n        chatId: this.item.chatId,\n        pageNum: this.state.pageNum,\n        pageSize: this.state.pageSize\n      },\n      successCB: res => {\n        this.state.pageNum++;\n        var list = res.result.list;\n        list.map(item => {\n          if (item.userId != this.user.userId) {\n            item.type = \"received\";\n          }\n\n          var nowTime = new Date().getTime();\n          var tomorrow = nowTime - 12 * 60 * 60 * 1000;\n\n          if (item.createTime < tomorrow) {\n            item.time = getTimeFormat(item.createTime);\n          } else {\n            item.time = getTimeHour(item.createTime);\n          }\n        });\n        console.log(list);\n        list = list.reverse();\n        this.initData = list.concat(this.initData); //已有的数组拼接上拉加载更多的数组\n\n        console.log(this.initData);\n        console.dir(ReactDOM.findDOMNode(this.lv));\n        const hei = this.state.height - ReactDOM.findDOMNode(this.lv).offsetTop - 50;\n        let total = res.result.total; //商品列表总数量\n\n        if (total == 0) {// this.setState({\n          //     statusText:\"暂无数据\"//总数为0时表示没有数据\n          // })\n        } else if (total == this.initData.length) {\n          this.setState({\n            dataSource: this.state.dataSource.cloneWithRows(this.initData),\n            height: hei,\n            refreshing: false,\n            isLoading: false,\n            hasMore: false //statusText:\"加载完成\"//拼接的数组长度等于总数时表示加载完成\n\n          });\n        } else {\n          this.setState({\n            dataSource: this.state.dataSource.cloneWithRows(this.initData),\n            isLoading: false,\n            refreshing: false\n          });\n        }\n      }\n    });\n  }\n\n  sendMessage() {\n    this.setState({\n      isShow: false\n    });\n    var value = this.refs.textarea.value;\n\n    if (!value) {\n      return;\n    }\n\n    this.time = new Date().getTime();\n    this.initData.push({\n      content: value,\n      time: getTimeHour(this.time)\n    });\n    this.setState({\n      dataSource: this.state.dataSource.cloneWithRows(this.initData)\n    });\n    var token = localStorage.getItem(\"token\");\n    var data = {\n      \"toUserId\": this.item.anotherUserId || this.item.publishUserId,\n      \"toUserName\": this.item.anotherUserName || this.item.publishUserName,\n      \"toUserAvatar\": this.item.anotherUserAvatar || this.item.publishUserAvatar,\n      \"chatId\": this.item.chatId,\n      \"token\": token,\n      \"content\": value\n    };\n\n    if (this.socket.readyState === 1) {\n      this.socket.send(JSON.stringify(data));\n    } else {//do something\n    }\n  }\n\n  changeState(e) {\n    this.setState({\n      value: e.target.value\n    });\n  }\n\n  render() {\n    var productImgs = this.item.productImgs && this.item.productImgs.split(\",\");\n\n    const row = (item, sectionID, rowID) => {\n      return React.createElement(\"div\", {\n        key: rowID,\n        className: \"cm-p-018\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225\n        },\n        __self: this\n      }, item.type == \"received\" ? React.createElement(\"div\", {\n        className: \"cm-tx-c\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"cm-mtb-018\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"cm-p-006 cm-border-radius-10 cm-bc-ddd cm-c-white cm-fs-024\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229\n        },\n        __self: this\n      }, item.time)), React.createElement(\"div\", {\n        className: \"cm-flex cm-ai-c cm-jc-fs\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        src: this.item.anotherUserAvatar || this.item.publishUserAvatar,\n        alt: \"\",\n        className: \"cm-img-06 cm-as-fs\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 232\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"cm-flex\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 233\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"detail-triangle-right\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"detail-chat-height cm-bc-white cm-tx-l\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 235\n        },\n        __self: this\n      }, item.anotherContent || item.content)))) : React.createElement(\"div\", {\n        className: \"cm-tx-c\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 240\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"cm-mtb-018\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"cm-p-006 cm-border-radius-10 cm-bc-ddd cm-c-white cm-fs-024\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 242\n        },\n        __self: this\n      }, item.time)), React.createElement(\"div\", {\n        className: \"cm-flex cm-ai-c cm-jc-fe\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 244\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"cm-flex\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \" detail-chat-height cm-bc-main-transparent cm-c-white cm-tx-l\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 246\n        },\n        __self: this\n      }, item.content), React.createElement(\"div\", {\n        className: \"detail-triangle\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 247\n        },\n        __self: this\n      })), React.createElement(\"img\", {\n        src: this.user.userAvatar,\n        alt: \"\",\n        className: \"cm-img-06 cm-as-fs\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249\n        },\n        __self: this\n      }))));\n    };\n\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 256\n      },\n      __self: this\n    }, React.createElement(Title, {\n      title: this.item.anotherUserName || this.item.publishUserName,\n      onLeftClick: this.onLeftClick.bind(this),\n      style: {\n        background: \"#fff\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 257\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"detail-fixed-height\",\n      onClick: () => this.close(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"cm-flex cm-jc-sb cm-p-018 detail-fixed\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 262\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"cm-flex cm-ai-c\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 263\n      },\n      __self: this\n    }, productImgs && productImgs[0] ? React.createElement(\"img\", {\n      src: productImgs[0],\n      alt: \"\",\n      className: \"cm-img-12 cm-mr-018\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265\n      },\n      __self: this\n    }) : React.createElement(\"div\", {\n      className: \"cm-img-12 cm-mr-018 cm-c-999 cm-fs-026 cm-border-ddd cm-flex cm-ai-c cm-tx-c\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266\n      },\n      __self: this\n    }, \"\\u8BE5\\u5546\\u54C1\\u5DF2\\u4E0B\\u67B6\"), React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 268\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"cm-c-main cm-fs-028 cm-fw-bold\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 269\n      },\n      __self: this\n    }, \"\\uFFE5123\"), React.createElement(\"div\", {\n      className: \"cm-c-999 cm-fs-026 cm-mt-018\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 270\n      },\n      __self: this\n    }, \"\\u4EA4\\u6613\\u524D\\u804A\\u4E00\\u804A\"))), productImgs && productImgs[0] ? React.createElement(\"div\", {\n      className: \"cm-btn-border-main cm-as-fe\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 274\n      },\n      __self: this\n    }, \"\\u7ACB\\u5373\\u8D2D\\u4E70\") : React.createElement(\"div\", {\n      className: \"cm-btn-border-999 cm-as-fe\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 275\n      },\n      __self: this\n    }, \"\\u7ACB\\u5373\\u8D2D\\u4E70\"))), React.createElement(\"div\", {\n      onClick: () => this.close(),\n      ref: \"chatList\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 279\n      },\n      __self: this\n    }, React.createElement(ListView, {\n      key: this.state.useBodyScroll ? '0' : '1',\n      ref: el => this.lv = el,\n      dataSource: this.state.dataSource,\n      renderRow: row,\n      useBodyScroll: this.state.useBodyScroll,\n      style: this.state.useBodyScroll ? {} : {\n        height: this.state.height\n      },\n      pullToRefresh: React.createElement(PullToRefresh, {\n        refreshing: this.state.refreshing,\n        onRefresh: this.onRefresh,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 289\n        },\n        __self: this\n      }),\n      pageSize: this.state.pageSize,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 280\n      },\n      __self: this\n    })), this.state.isShow ? React.createElement(\"div\", {\n      className: \"cm-bottom-position\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 297\n      },\n      __self: this\n    }, React.createElement(\"textarea\", {\n      onChange: e => this.changeState(e),\n      onkeydown: e => this.abc(e),\n      ref: \"textarea\",\n      className: \"cm-border-ddd cm-border-radius-10 cm-mr-018 cm-flex-1 cm-p-009\",\n      name: \"\",\n      id: \"\",\n      cols: \"30\",\n      rows: \"2\",\n      placeholder: \"\\u60F3\\u8DDF\\u4ED6\\u8BF4\\u70B9\\u4EC0\\u4E48\\u5462\\uFF1F\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 298\n      },\n      __self: this\n    }), React.createElement(\"span\", {\n      className: \"cm-btn-main cm-as-fe\",\n      onClick: () => this.sendMessage(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 303\n      },\n      __self: this\n    }, \"\\u53D1\\u9001\")) : React.createElement(\"div\", {\n      className: \"detail-height\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 305\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"cm-bottom-position\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 306\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      type: \"text\",\n      placeholder: \"\\u60F3\\u8DDF\\u4ED6\\u8BF4\\u70B9\\u4EC0\\u4E48\\u5462\\uFF1F\",\n      className: \"cm-border-ddd cm-border-radius-10 cm-mr-018 cm-flex-1 cm-p-009\",\n      onClick: e => this.openChat(e),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 307\n      },\n      __self: this\n    }), React.createElement(\"span\", {\n      className: \"cm-btn-main\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 308\n      },\n      __self: this\n    }, \"\\u53D1\\u9001\"))));\n  }\n\n}","map":{"version":3,"sources":["C:\\Users\\caoxue\\Desktop\\secondary\\src\\pages\\message\\messageDetail.js"],"names":["React","Title","PullToRefresh","ListView","ReactDOM","getData","getTimeFormat","getTimeHour","autoTextarea","self","MessageDetail","Component","constructor","props","onRefresh","state","hasMore","setState","refreshing","isLoading","setTimeout","getChatDetailList","item","history","location","user","localStorage","getItem","JSON","parse","dataSource","DataSource","rowHasChanged","row1","row2","height","document","documentElement","clientHeight","useBodyScroll","pageNum","pageSize","value","isShow","initData","componentDidMount","textarea","getElementsByTagName","i","length","style","scrollTop","scrollHeight","addEventListener","e","target","chatList","refs","socket","WebSocket","userId","heartCheck","timeout","timeoutObj","serverTimeoutObj","reset","clearTimeout","start","that","console","log","send","close","onopen","onmessage","msg","data","indexOf","obj","push","content","type","time","Date","getTime","cloneWithRows","onerror","err","onLeftClick","goBack","openChat","stopPropagation","abc","event","alert","keyCode","preventDefault","method","url","chatId","successCB","res","list","result","map","nowTime","tomorrow","createTime","reverse","concat","dir","findDOMNode","lv","hei","offsetTop","total","sendMessage","token","anotherUserId","publishUserId","anotherUserName","publishUserName","anotherUserAvatar","publishUserAvatar","readyState","stringify","changeState","render","productImgs","split","row","sectionID","rowID","anotherContent","userAvatar","bind","background","el"],"mappings":";;AAAA;;;AAGA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAO,eAAP;AACA,SAAQC,KAAR,QAAoB,aAApB;AACA,SAASC,aAAT,EAAwBC,QAAxB,QAAuC,aAAvC;AACA,OAAOC,QAAP,MAAqB,WAArB;AACA,SAAQC,OAAR,EAAgBC,aAAhB,EAA+BC,WAA/B,EAA2CC,YAA3C,QAA8D,aAA9D;AACA,IAAIC,IAAJ;AACA,eAAe,MAAMC,aAAN,SAA4BV,KAAK,CAACW,SAAlC,CAA4C;AACvDC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACf,UAAMA,KAAN,EADe,CAEf;;AAFe,SA4FnBC,SA5FmB,GA4FP,MAAM;AACd,UAAG,CAAC,KAAKC,KAAL,CAAWC,OAAf,EAAuB;AACnB;AACH;;AACD,WAAKC,QAAL,CAAc;AAAEC,QAAAA,UAAU,EAAE,IAAd;AAAoBC,QAAAA,SAAS,EAAE;AAA/B,OAAd,EAJc,CAKd;;AACAC,MAAAA,UAAU,CAAC,MAAM;AACb,aAAKC,iBAAL;AACH,OAFS,EAEP,GAFO,CAAV;AAGH,KArGkB;;AAGf,SAAKC,IAAL,GAAY,KAAKT,KAAL,CAAWU,OAAX,CAAmBC,QAAnB,CAA4BT,KAA5B,IAAqC,EAAjD,CAHe,CAIf;;AACA,SAAKU,IAAL,GAAYC,YAAY,CAACC,OAAb,CAAqB,UAArB,IAAiCC,IAAI,CAACC,KAAL,CAAWH,YAAY,CAACC,OAAb,CAAqB,UAArB,CAAX,CAAjC,GAA8E,EAA1F,CALe,CAMf;;AACA,UAAMG,UAAU,GAAG,IAAI3B,QAAQ,CAAC4B,UAAb,CAAwB;AACvCC,MAAAA,aAAa,EAAE,CAACC,IAAD,EAAOC,IAAP,KAAgBD,IAAI,KAAKC;AADD,KAAxB,CAAnB;AAGAzB,IAAAA,IAAI,GAAG,IAAP;AACA,SAAKM,KAAL,GAAa;AACTe,MAAAA,UADS;AAETZ,MAAAA,UAAU,EAAE,IAFH;AAGTF,MAAAA,OAAO,EAAC,IAHC;AAITG,MAAAA,SAAS,EAAE,IAJF;AAKTgB,MAAAA,MAAM,EAAEC,QAAQ,CAACC,eAAT,CAAyBC,YALxB;AAMTC,MAAAA,aAAa,EAAE,KANN;AAOTC,MAAAA,OAAO,EAAC,CAPC;AAOC;AACVC,MAAAA,QAAQ,EAAC,EARA;AAQG;AACZC,MAAAA,KAAK,EAAE,IATE;AAUTC,MAAAA,MAAM,EAAC;AAVE,KAAb;AAYA,SAAKC,QAAL,GAAgB,EAAhB;AACH;;AAEDC,EAAAA,iBAAiB,GAAG;AAChB,QAAIC,QAAQ,GAAGV,QAAQ,CAACW,oBAAT,CAA8B,OAA9B,CAAf;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,QAAQ,CAACG,MAA7B,EAAqCD,CAAC,EAAtC,EAA0C;AACtCF,MAAAA,QAAQ,CAACE,CAAD,CAAR,CAAYE,KAAZ,CAAkBf,MAAlB,GAA2B,QAA3B;AACAW,MAAAA,QAAQ,CAACE,CAAD,CAAR,CAAYG,SAAZ,GAAwB,CAAxB,CAFsC,CAEX;;AAC3BL,MAAAA,QAAQ,CAACE,CAAD,CAAR,CAAYE,KAAZ,CAAkBf,MAAlB,GAA2BW,QAAQ,CAACE,CAAD,CAAR,CAAYI,YAAZ,GAA2B,IAAtD;AACAN,MAAAA,QAAQ,CAACE,CAAD,CAAR,CAAYK,gBAAZ,CAA6B,OAA7B,EAAsC,UAAUC,CAAV,EAAa;AAC/CA,QAAAA,CAAC,CAACC,MAAF,CAASL,KAAT,CAAef,MAAf,GAAwB,MAAxB;AACAmB,QAAAA,CAAC,CAACC,MAAF,CAASJ,SAAT,GAAqB,CAArB,CAF+C,CAEvB;;AACxB,YAAIG,CAAC,CAACC,MAAF,CAASH,YAAT,GAAwB,EAA5B,EAAgC;AAC5BE,UAAAA,CAAC,CAACC,MAAF,CAASL,KAAT,CAAef,MAAf,GAAwB,MAAxB;AACH,SAFD,MAEO;AACHmB,UAAAA,CAAC,CAACC,MAAF,CAASL,KAAT,CAAef,MAAf,GAAwBmB,CAAC,CAACC,MAAF,CAASH,YAAT,GAAwB,IAAhD;AACH;AACJ,OARD;AASH;;AACD,SAAK/B,iBAAL;AACA,QAAImC,QAAQ,GAAG,KAAKC,IAAL,CAAUD,QAAzB;AACAA,IAAAA,QAAQ,CAACH,gBAAT,CAA0B,YAA1B,EAAuC,MAAI;AACvC,WAAKpC,QAAL,CAAc;AACV0B,QAAAA,MAAM,EAAC;AADG,OAAd;AAGH,KAJD;AAKA,SAAKe,MAAL,GAAc,IAAIC,SAAJ,CAAc,8CAA8C,KAAKlC,IAAL,CAAUmC,MAAtE,CAAd,CAvBgB,CAwBhB;;AACA,SAAKC,UAAL,GAAkB;AACdC,MAAAA,OAAO,EAAE,KADK;AACE;AAChBC,MAAAA,UAAU,EAAE,IAFE;AAGdC,MAAAA,gBAAgB,EAAE,IAHJ;AAIdC,MAAAA,KAAK,EAAE,YAAW;AACdC,QAAAA,YAAY,CAAC,KAAKH,UAAN,CAAZ;AACAG,QAAAA,YAAY,CAAC,KAAKF,gBAAN,CAAZ;AACA,eAAO,IAAP;AACH,OARa;AASdG,MAAAA,KAAK,EAAE,YAAW;AACd,YAAIC,IAAI,GAAG,IAAX;AACA,aAAKL,UAAL,GAAkB3C,UAAU,CAAC,YAAW;AACpCiD,UAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ,EADoC,CAEpC;AACA;;AACA7D,UAAAA,IAAI,CAACiD,MAAL,CAAYa,IAAZ,CAAiB,kBAAkB9D,IAAI,CAACgB,IAAL,CAAUmC,MAA5B,GAAqC,GAAtD;AACAQ,UAAAA,IAAI,CAACJ,gBAAL,GAAwB5C,UAAU,CAAC,YAAW;AAAE;AAC5CX,YAAAA,IAAI,CAACiD,MAAL,CAAYc,KAAZ,GAD0C,CACrB;AACxB,WAFiC,EAE/BJ,IAAI,CAACN,OAF0B,CAAlC;AAGH,SAR2B,EAQzB,KAAKA,OARoB,CAA5B;AASH;AApBa,KAAlB;;AAsBA,SAAKJ,MAAL,CAAYe,MAAZ,GAAqB,MAAI;AACrB,WAAKZ,UAAL,CAAgBI,KAAhB,GAAwBE,KAAxB,GADqB,CACY;;AACjCE,MAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACH,KAHD;;AAIA,SAAKZ,MAAL,CAAYgB,SAAZ,GAA0BC,GAAD,IAAQ;AAC7B,WAAKd,UAAL,CAAgBI,KAAhB,GAAwBE,KAAxB,GAD6B,CACI;;AACjC,UAAIQ,GAAG,CAACC,IAAJ,CAASC,OAAT,CAAiB,GAAjB,KAAyB,CAAC,CAA9B,EAAiC;AAC7BR,QAAAA,OAAO,CAACC,GAAR,CAAYK,GAAZ;AACA,YAAIG,GAAG,GAAGlD,IAAI,CAACC,KAAL,CAAW8C,GAAG,CAACC,IAAf,CAAV;AACA,aAAKhC,QAAL,CAAcmC,IAAd,CAAmB;AAACC,UAAAA,OAAO,EAAEF,GAAG,CAACE,OAAd;AAAsBC,UAAAA,IAAI,EAAC,UAA3B;AAAsCC,UAAAA,IAAI,EAAE3E,WAAW,CAAC,IAAI4E,IAAJ,GAAWC,OAAX,EAAD;AAAvD,SAAnB;AACA,aAAKnE,QAAL,CAAc;AACVa,UAAAA,UAAU,EAAE,KAAKf,KAAL,CAAWe,UAAX,CAAsBuD,aAAtB,CAAoC,KAAKzC,QAAzC;AADF,SAAd;AAGH;AACJ,KAVD;;AAWA,SAAKc,MAAL,CAAY4B,OAAZ,GAAsB,UAAUC,GAAV,EAAe;AACjClB,MAAAA,OAAO,CAACC,GAAR,CAAYiB,GAAZ;AACH,KAFD;AAGH;;AAYDC,EAAAA,WAAW,GAAG;AACV,SAAK3E,KAAL,CAAWU,OAAX,CAAmBkE,MAAnB;AACH;;AACDC,EAAAA,QAAQ,CAACpC,CAAD,EAAG;AACPA,IAAAA,CAAC,CAACqC,eAAF;AACA,SAAK1E,QAAL,CAAc;AACV0B,MAAAA,MAAM,EAAC;AADG,KAAd,EAEE,YAAY;AACVnC,MAAAA,YAAY;AACf,KAJD;AAKH;;AACDoF,EAAAA,GAAG,CAACC,KAAD,EAAO;AACNC,IAAAA,KAAK,CAAC,GAAD,CAAL;;AACA,QAAID,KAAK,CAACE,OAAN,IAAiB,EAArB,EAAyB;AAAE;AACvBF,MAAAA,KAAK,CAACG,cAAN,GADqB,CACG;;AACzBF,MAAAA,KAAK,CAAC,GAAD,CAAL;AACF;AACJ;;AACDzE,EAAAA,iBAAiB,GAAG;AAChBhB,IAAAA,OAAO,CAAC;AACJ4F,MAAAA,MAAM,EAAE,MADJ;AAEJC,MAAAA,GAAG,EAAE,mBAFD;AAGJtB,MAAAA,IAAI,EAAE;AACFuB,QAAAA,MAAM,EAAC,KAAK7E,IAAL,CAAU6E,MADf;AAEF3D,QAAAA,OAAO,EAAC,KAAKzB,KAAL,CAAWyB,OAFjB;AAGFC,QAAAA,QAAQ,EAAC,KAAK1B,KAAL,CAAW0B;AAHlB,OAHF;AAQJ2D,MAAAA,SAAS,EAAGC,GAAD,IAAS;AAChB,aAAKtF,KAAL,CAAWyB,OAAX;AACA,YAAI8D,IAAI,GAAGD,GAAG,CAACE,MAAJ,CAAWD,IAAtB;AACAA,QAAAA,IAAI,CAACE,GAAL,CAAUlF,IAAD,IAAQ;AACb,cAAGA,IAAI,CAACsC,MAAL,IAAe,KAAKnC,IAAL,CAAUmC,MAA5B,EAAmC;AAC/BtC,YAAAA,IAAI,CAAC2D,IAAL,GAAU,UAAV;AACH;;AACD,cAAIwB,OAAO,GAAI,IAAItB,IAAJ,EAAD,CAAaC,OAAb,EAAd;AACA,cAAIsB,QAAQ,GAAGD,OAAO,GAAG,KAAG,EAAH,GAAM,EAAN,GAAS,IAAlC;;AACA,cAAGnF,IAAI,CAACqF,UAAL,GAAgBD,QAAnB,EAA4B;AACxBpF,YAAAA,IAAI,CAAC4D,IAAL,GAAY5E,aAAa,CAACgB,IAAI,CAACqF,UAAN,CAAzB;AACH,WAFD,MAEM;AACFrF,YAAAA,IAAI,CAAC4D,IAAL,GAAY3E,WAAW,CAACe,IAAI,CAACqF,UAAN,CAAvB;AACH;AACJ,SAXD;AAYAtC,QAAAA,OAAO,CAACC,GAAR,CAAYgC,IAAZ;AACAA,QAAAA,IAAI,GAAGA,IAAI,CAACM,OAAL,EAAP;AACA,aAAKhE,QAAL,GAAgB0D,IAAI,CAACO,MAAL,CAAY,KAAKjE,QAAjB,CAAhB,CAjBgB,CAiB2B;;AAC3CyB,QAAAA,OAAO,CAACC,GAAR,CAAY,KAAK1B,QAAjB;AACAyB,QAAAA,OAAO,CAACyC,GAAR,CAAY1G,QAAQ,CAAC2G,WAAT,CAAqB,KAAKC,EAA1B,CAAZ;AACA,cAAMC,GAAG,GAAG,KAAKlG,KAAL,CAAWoB,MAAX,GAAoB/B,QAAQ,CAAC2G,WAAT,CAAqB,KAAKC,EAA1B,EAA8BE,SAAlD,GAA4D,EAAxE;AACA,YAAIC,KAAK,GAAGd,GAAG,CAACE,MAAJ,CAAWY,KAAvB,CArBgB,CAqBa;;AAC7B,YAAGA,KAAK,IAAI,CAAZ,EAAc,CACV;AACA;AACA;AACH,SAJD,MAIM,IAAGA,KAAK,IAAI,KAAKvE,QAAL,CAAcK,MAA1B,EAAiC;AACnC,eAAKhC,QAAL,CAAc;AACVa,YAAAA,UAAU,EAAE,KAAKf,KAAL,CAAWe,UAAX,CAAsBuD,aAAtB,CAAoC,KAAKzC,QAAzC,CADF;AAEVT,YAAAA,MAAM,EAAE8E,GAFE;AAGV/F,YAAAA,UAAU,EAAE,KAHF;AAIVC,YAAAA,SAAS,EAAE,KAJD;AAKVH,YAAAA,OAAO,EAAC,KALE,CAMV;;AANU,WAAd;AAQH,SATK,MASA;AACF,eAAKC,QAAL,CAAc;AACVa,YAAAA,UAAU,EAAE,KAAKf,KAAL,CAAWe,UAAX,CAAsBuD,aAAtB,CAAoC,KAAKzC,QAAzC,CADF;AAEVzB,YAAAA,SAAS,EAAE,KAFD;AAGVD,YAAAA,UAAU,EAAE;AAHF,WAAd;AAKH;AACJ;AAlDG,KAAD,CAAP;AAoDH;;AACDkG,EAAAA,WAAW,GAAG;AACV,SAAKnG,QAAL,CAAc;AACV0B,MAAAA,MAAM,EAAE;AADE,KAAd;AAGA,QAAID,KAAK,GAAG,KAAKe,IAAL,CAAUX,QAAV,CAAmBJ,KAA/B;;AACA,QAAI,CAACA,KAAL,EAAY;AACR;AACH;;AACD,SAAKwC,IAAL,GAAY,IAAIC,IAAJ,GAAWC,OAAX,EAAZ;AACA,SAAKxC,QAAL,CAAcmC,IAAd,CAAmB;AAACC,MAAAA,OAAO,EAAEtC,KAAV;AAAgBwC,MAAAA,IAAI,EAAC3E,WAAW,CAAC,KAAK2E,IAAN;AAAhC,KAAnB;AACA,SAAKjE,QAAL,CAAc;AACVa,MAAAA,UAAU,EAAE,KAAKf,KAAL,CAAWe,UAAX,CAAsBuD,aAAtB,CAAoC,KAAKzC,QAAzC;AADF,KAAd;AAGA,QAAIyE,KAAK,GAAG3F,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAZ;AACA,QAAIiD,IAAI,GAAG;AACP,kBAAY,KAAKtD,IAAL,CAAUgG,aAAV,IAAyB,KAAKhG,IAAL,CAAUiG,aADxC;AAEP,oBAAc,KAAKjG,IAAL,CAAUkG,eAAV,IAA2B,KAAKlG,IAAL,CAAUmG,eAF5C;AAGP,sBAAgB,KAAKnG,IAAL,CAAUoG,iBAAV,IAA6B,KAAKpG,IAAL,CAAUqG,iBAHhD;AAIP,gBAAS,KAAKrG,IAAL,CAAU6E,MAJZ;AAKP,eAASkB,KALF;AAMP,iBAAW3E;AANJ,KAAX;;AAQA,QAAI,KAAKgB,MAAL,CAAYkE,UAAZ,KAA2B,CAA/B,EAAkC;AAC9B,WAAKlE,MAAL,CAAYa,IAAZ,CAAiB3C,IAAI,CAACiG,SAAL,CAAejD,IAAf,CAAjB;AACH,KAFD,MAEO,CACH;AACH;AACJ;;AAEDkD,EAAAA,WAAW,CAACxE,CAAD,EAAI;AACX,SAAKrC,QAAL,CAAc;AACVyB,MAAAA,KAAK,EAAEY,CAAC,CAACC,MAAF,CAASb;AADN,KAAd;AAGH;;AACDqF,EAAAA,MAAM,GAAG;AACL,QAAIC,WAAW,GAAG,KAAK1G,IAAL,CAAU0G,WAAV,IAAyB,KAAK1G,IAAL,CAAU0G,WAAV,CAAsBC,KAAtB,CAA4B,GAA5B,CAA3C;;AACA,UAAMC,GAAG,GAAG,CAAC5G,IAAD,EAAO6G,SAAP,EAAkBC,KAAlB,KAA4B;AACpC,aACI;AAAK,QAAA,GAAG,EAAEA,KAAV;AAAiB,QAAA,SAAS,EAAC,UAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACK9G,IAAI,CAAC2D,IAAL,IAAa,UAAb,GACG;AAAK,QAAA,SAAS,EAAC,SAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAK,QAAA,SAAS,EAAC,YAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAM,QAAA,SAAS,EAAC,6DAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAA+E3D,IAAI,CAAC4D,IAApF,CADJ,CADJ,EAII;AAAK,QAAA,SAAS,EAAC,0BAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAK,QAAA,GAAG,EAAE,KAAK5D,IAAL,CAAUoG,iBAAV,IAA6B,KAAKpG,IAAL,CAAUqG,iBAAjD;AAAoE,QAAA,GAAG,EAAC,EAAxE;AAA2E,QAAA,SAAS,EAAC,oBAArF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,EAEI;AAAK,QAAA,SAAS,EAAC,SAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAK,QAAA,SAAS,EAAC,uBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,EAEI;AAAK,QAAA,SAAS,EAAC,wCAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAyDrG,IAAI,CAAC+G,cAAL,IAAqB/G,IAAI,CAAC0D,OAAnF,CAFJ,CAFJ,CAJJ,CADH,GAcG;AAAK,QAAA,SAAS,EAAC,SAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAK,QAAA,SAAS,EAAC,YAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACA;AAAM,QAAA,SAAS,EAAC,6DAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAA+E1D,IAAI,CAAC4D,IAApF,CADA,CADJ,EAII;AAAK,QAAA,SAAS,EAAC,0BAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAK,QAAA,SAAS,EAAC,SAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAK,QAAA,SAAS,EAAC,+DAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAgF5D,IAAI,CAAC0D,OAArF,CADJ,EAEI;AAAK,QAAA,SAAS,EAAC,iBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFJ,CADJ,EAKI;AAAK,QAAA,GAAG,EAAE,KAAKvD,IAAL,CAAU6G,UAApB;AAAgC,QAAA,GAAG,EAAC,EAApC;AAAuC,QAAA,SAAS,EAAC,oBAAjD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QALJ,CAJJ,CAfR,CADJ;AA+BH,KAhCD;;AAiCA,WAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACH,oBAAC,KAAD;AAAO,MAAA,KAAK,EAAE,KAAKhH,IAAL,CAAUkG,eAAV,IAA2B,KAAKlG,IAAL,CAAUmG,eAAnD;AACO,MAAA,WAAW,EAAE,KAAKjC,WAAL,CAAiB+C,IAAjB,CAAsB,IAAtB,CADpB;AAEO,MAAA,KAAK,EAAE;AAACC,QAAAA,UAAU,EAAC;AAAZ,OAFd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADG,EAKH;AAAK,MAAA,SAAS,EAAC,qBAAf;AAAqC,MAAA,OAAO,EAAE,MAAI,KAAKhE,KAAL,EAAlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACA;AAAK,MAAA,SAAS,EAAC,wCAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACA;AAAK,MAAA,SAAS,EAAC,iBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACKwD,WAAW,IAAIA,WAAW,CAAC,CAAD,CAA1B,GACG;AAAK,MAAA,GAAG,EAAEA,WAAW,CAAC,CAAD,CAArB;AAA0B,MAAA,GAAG,EAAC,EAA9B;AAAiC,MAAA,SAAS,EAAC,qBAA3C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADH,GAEG;AAAK,MAAA,SAAS,EAAC,8EAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8CAHR,EAKI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAK,MAAA,SAAS,EAAC,gCAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBADJ,EAEI;AAAK,MAAA,SAAS,EAAC,8BAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8CAFJ,CALJ,CADA,EAWKA,WAAW,IAAIA,WAAW,CAAC,CAAD,CAA1B,GACD;AAAK,MAAA,SAAS,EAAC,6BAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kCADC,GAEG;AAAK,MAAA,SAAS,EAAC,4BAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kCAbR,CADA,CALG,EAuBH;AAAK,MAAA,OAAO,EAAE,MAAI,KAAKxD,KAAL,EAAlB;AAAgC,MAAA,GAAG,EAAC,UAApC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI,oBAAC,QAAD;AACI,MAAA,GAAG,EAAE,KAAKzD,KAAL,CAAWwB,aAAX,GAA2B,GAA3B,GAAiC,GAD1C;AAEI,MAAA,GAAG,EAAEkG,EAAE,IAAI,KAAKzB,EAAL,GAAUyB,EAFzB;AAGI,MAAA,UAAU,EAAE,KAAK1H,KAAL,CAAWe,UAH3B;AAII,MAAA,SAAS,EAAEoG,GAJf;AAKI,MAAA,aAAa,EAAE,KAAKnH,KAAL,CAAWwB,aAL9B;AAMI,MAAA,KAAK,EAAE,KAAKxB,KAAL,CAAWwB,aAAX,GAA2B,EAA3B,GAAgC;AAC/BJ,QAAAA,MAAM,EAAE,KAAKpB,KAAL,CAAWoB;AADY,OAN3C;AASI,MAAA,aAAa,EAAE,oBAAC,aAAD;AACX,QAAA,UAAU,EAAE,KAAKpB,KAAL,CAAWG,UADZ;AAEX,QAAA,SAAS,EAAE,KAAKJ,SAFL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QATnB;AAaI,MAAA,QAAQ,EAAE,KAAKC,KAAL,CAAW0B,QAbzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADJ,CAvBG,EAwCF,KAAK1B,KAAL,CAAW4B,MAAX,GACD;AAAK,MAAA,SAAS,EAAC,oBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAU,MAAA,QAAQ,EAAGW,CAAD,IAAO,KAAKwE,WAAL,CAAiBxE,CAAjB,CAA3B;AACU,MAAA,SAAS,EAAGA,CAAD,IAAK,KAAKsC,GAAL,CAAStC,CAAT,CAD1B;AAEU,MAAA,GAAG,EAAC,UAFd;AAGU,MAAA,SAAS,EAAC,gEAHpB;AAGqF,MAAA,IAAI,EAAC,EAH1F;AAIU,MAAA,EAAE,EAAC,EAJb;AAIgB,MAAA,IAAI,EAAC,IAJrB;AAI0B,MAAA,IAAI,EAAC,GAJ/B;AAImC,MAAA,WAAW,EAAC,wDAJ/C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADJ,EAMI;AAAM,MAAA,SAAS,EAAC,sBAAhB;AACM,MAAA,OAAO,EAAE,MAAM,KAAK8D,WAAL,EADrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBANJ,CADC,GASM;AAAK,MAAA,SAAS,EAAC,eAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC;AAAK,MAAA,SAAS,EAAC,oBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAO,MAAA,IAAI,EAAC,MAAZ;AAAmB,MAAA,WAAW,EAAC,wDAA/B;AAA2C,MAAA,SAAS,EAAC,gEAArD;AAAsH,MAAA,OAAO,EAAG9D,CAAD,IAAO,KAAKoC,QAAL,CAAcpC,CAAd,CAAtI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADJ,EAEI;AAAM,MAAA,SAAS,EAAC,aAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAFJ,CADD,CAjDJ,CAAP;AAwDH;;AA7SsD","sourcesContent":["/**\r\n * Created by Lenovo on 2019/9/2.\r\n */\r\nimport React from 'react';\r\nimport './message.css';\r\nimport {Title} from '../../share';\r\nimport { PullToRefresh, ListView} from 'antd-mobile';\r\nimport ReactDOM from 'react-dom';\r\nimport {getData,getTimeFormat, getTimeHour,autoTextarea} from '../../utils';\r\nlet self;\r\nexport default class MessageDetail extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        //获取从聊天列表页面和商品详情页传过来的参数\r\n        this.item = this.props.history.location.state || {};\r\n        //获取本地缓存的个人信息\r\n        this.user = localStorage.getItem(\"userInfo\")?JSON.parse(localStorage.getItem(\"userInfo\")):{};\r\n        //初始化聊天记录数据源\r\n        const dataSource = new ListView.DataSource({\r\n            rowHasChanged: (row1, row2) => row1 !== row2,\r\n        });\r\n        self = this;\r\n        this.state = {\r\n            dataSource,\r\n            refreshing: true,\r\n            hasMore:true,\r\n            isLoading: true,\r\n            height: document.documentElement.clientHeight,\r\n            useBodyScroll: false,\r\n            pageNum:1,//定义初始化请求序号\r\n            pageSize:10,//定义初始化请求数量\r\n            value: null,\r\n            isShow:false\r\n        }\r\n        this.initData = [];\r\n    }\r\n\r\n    componentDidMount() {\r\n        var textarea = document.getElementsByTagName(\"input\");\r\n        for (var i = 0; i < textarea.length; i++) {\r\n            textarea[i].style.height = '0.4rem';\r\n            textarea[i].scrollTop = 0; //防抖动\r\n            textarea[i].style.height = textarea[i].scrollHeight + 'px';\r\n            textarea[i].addEventListener('input', function (e) {\r\n                e.target.style.height = 'auto';\r\n                e.target.scrollTop = 0; //防抖动\r\n                if (e.target.scrollHeight < 20) {\r\n                    e.target.style.height = '20px';\r\n                } else {\r\n                    e.target.style.height = e.target.scrollHeight + 'px';\r\n                }\r\n            })\r\n        }\r\n        this.getChatDetailList();\r\n        var chatList = this.refs.chatList;\r\n        chatList.addEventListener(\"touchstart\",()=>{\r\n            this.setState({\r\n                isShow:false\r\n            })\r\n        });\r\n        this.socket = new WebSocket(\"ws://49.232.24.206:9001/secondary/socket?\" + this.user.userId);\r\n        //心跳检测\r\n        this.heartCheck = {\r\n            timeout: 60000, //心跳间隔时间，单位ms\r\n            timeoutObj: null,\r\n            serverTimeoutObj: null,\r\n            reset: function() {\r\n                clearTimeout(this.timeoutObj);\r\n                clearTimeout(this.serverTimeoutObj);\r\n                return this;\r\n            },\r\n            start: function() {\r\n                var that = this;\r\n                this.timeoutObj = setTimeout(function() {\r\n                    console.log(this);\r\n                    //这里发送一个心跳，后端收到后，返回一个心跳消息，\r\n                    //onmessage拿到返回的心跳就说明连接正常\r\n                    self.socket.send(\"heartbeat...【\" + self.user.userId + \"】\");\r\n                    that.serverTimeoutObj = setTimeout(function() { //如果超过一定时间还没重置，说明后端主动断开了\r\n                        self.socket.close(); //如果onclose会执行reconnect，我们执行ws.close()就行了.如果直接执行reconnect 会触发onclose导致重连两次\r\n                    }, that.timeout)\r\n                }, this.timeout)\r\n            }\r\n        }\r\n        this.socket.onopen = ()=>{\r\n            this.heartCheck.reset().start(); //心跳检测重置\r\n            console.log(\"Socket 已打开\");\r\n        };\r\n        this.socket.onmessage =  (msg)=> {\r\n            this.heartCheck.reset().start(); //心跳检测重置\r\n            if (msg.data.indexOf(\"{\") != -1) {\r\n                console.log(msg);\r\n                var obj = JSON.parse(msg.data);\r\n                this.initData.push({content: obj.content,type:'received',time: getTimeHour(new Date().getTime())});\r\n                this.setState({\r\n                    dataSource: this.state.dataSource.cloneWithRows(this.initData),\r\n                })\r\n            }\r\n        };\r\n        this.socket.onerror = function (err) {\r\n            console.log(err);\r\n        };\r\n    }\r\n    onRefresh = () => {\r\n        if(!this.state.hasMore){\r\n            return;\r\n        }\r\n        this.setState({ refreshing: true, isLoading: true });\r\n        // simulate initial Ajax\r\n        setTimeout(() => {\r\n            this.getChatDetailList();\r\n        }, 600);\r\n    };\r\n\r\n    onLeftClick() {\r\n        this.props.history.goBack();\r\n    }\r\n    openChat(e){\r\n        e.stopPropagation();\r\n        this.setState({\r\n            isShow:true\r\n        },function () {\r\n            autoTextarea();\r\n        })\r\n    }\r\n    abc(event){\r\n        alert(888)\r\n        if (event.keyCode == 13) { //如果按的是enter键 13是enter\r\n            event.preventDefault(); //禁止默认事件（默认是换行）\r\n           alert(555)\r\n        }\r\n    }\r\n    getChatDetailList() {\r\n        getData({\r\n            method: 'post',\r\n            url: 'getChatDetailList',\r\n            data: {\r\n                chatId:this.item.chatId,\r\n                pageNum:this.state.pageNum,\r\n                pageSize:this.state.pageSize,\r\n            },\r\n            successCB: (res) => {\r\n                this.state.pageNum++;\r\n                var list = res.result.list;\r\n                list.map((item)=>{\r\n                    if(item.userId != this.user.userId){\r\n                        item.type=\"received\";\r\n                    }\r\n                    var nowTime = (new Date()).getTime();\r\n                    var tomorrow = nowTime - 12*60*60*1000;\r\n                    if(item.createTime<tomorrow){\r\n                        item.time = getTimeFormat(item.createTime);\r\n                    }else {\r\n                        item.time = getTimeHour(item.createTime)\r\n                    }\r\n                });\r\n                console.log(list);\r\n                list = list.reverse();\r\n                this.initData = list.concat(this.initData);//已有的数组拼接上拉加载更多的数组\r\n                console.log(this.initData);\r\n                console.dir(ReactDOM.findDOMNode(this.lv));\r\n                const hei = this.state.height - ReactDOM.findDOMNode(this.lv).offsetTop-50;\r\n                let total = res.result.total;//商品列表总数量\r\n                if(total == 0){\r\n                    // this.setState({\r\n                    //     statusText:\"暂无数据\"//总数为0时表示没有数据\r\n                    // })\r\n                }else if(total == this.initData.length){\r\n                    this.setState({\r\n                        dataSource: this.state.dataSource.cloneWithRows(this.initData),\r\n                        height: hei,\r\n                        refreshing: false,\r\n                        isLoading: false,\r\n                        hasMore:false,\r\n                        //statusText:\"加载完成\"//拼接的数组长度等于总数时表示加载完成\r\n                    })\r\n                }else {\r\n                    this.setState({\r\n                        dataSource: this.state.dataSource.cloneWithRows(this.initData),\r\n                        isLoading: false,\r\n                        refreshing: false,\r\n                    });\r\n                }\r\n            }\r\n        })\r\n    }\r\n    sendMessage() {\r\n        this.setState({\r\n            isShow: false\r\n        });\r\n        var value = this.refs.textarea.value;\r\n        if (!value) {\r\n            return;\r\n        }\r\n        this.time = new Date().getTime();\r\n        this.initData.push({content: value,time:getTimeHour(this.time)});\r\n        this.setState({\r\n            dataSource: this.state.dataSource.cloneWithRows(this.initData),\r\n        })\r\n        var token = localStorage.getItem(\"token\");\r\n        var data = {\r\n            \"toUserId\": this.item.anotherUserId||this.item.publishUserId,\r\n            \"toUserName\": this.item.anotherUserName||this.item.publishUserName,\r\n            \"toUserAvatar\": this.item.anotherUserAvatar||this.item.publishUserAvatar,\r\n            \"chatId\":this.item.chatId,\r\n            \"token\": token,\r\n            \"content\": value,\r\n        };\r\n        if (this.socket.readyState === 1) {\r\n            this.socket.send(JSON.stringify(data));\r\n        } else {\r\n            //do something\r\n        }\r\n    }\r\n\r\n    changeState(e) {\r\n        this.setState({\r\n            value: e.target.value\r\n        })\r\n    }\r\n    render() {\r\n        var productImgs = this.item.productImgs && this.item.productImgs.split(\",\");\r\n        const row = (item, sectionID, rowID) => {\r\n            return (\r\n                <div key={rowID} className=\"cm-p-018\">\r\n                    {item.type == \"received\"?\r\n                        <div className=\"cm-tx-c\">\r\n                            <div className=\"cm-mtb-018\">\r\n                                <span className=\"cm-p-006 cm-border-radius-10 cm-bc-ddd cm-c-white cm-fs-024\">{item.time}</span>\r\n                            </div>\r\n                            <div className=\"cm-flex cm-ai-c cm-jc-fs\">\r\n                                <img src={this.item.anotherUserAvatar||this.item.publishUserAvatar} alt=\"\" className=\"cm-img-06 cm-as-fs\"/>\r\n                                <div className=\"cm-flex\">\r\n                                    <div className=\"detail-triangle-right\"></div>\r\n                                    <div className=\"detail-chat-height cm-bc-white cm-tx-l\">{item.anotherContent||item.content}</div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        :\r\n                        <div className=\"cm-tx-c\">\r\n                            <div className=\"cm-mtb-018\">\r\n                            <span className=\"cm-p-006 cm-border-radius-10 cm-bc-ddd cm-c-white cm-fs-024\">{item.time}</span>\r\n                            </div>\r\n                            <div className=\"cm-flex cm-ai-c cm-jc-fe\">\r\n                                <div className=\"cm-flex\">\r\n                                    <div className=\" detail-chat-height cm-bc-main-transparent cm-c-white cm-tx-l\">{item.content}</div>\r\n                                    <div className=\"detail-triangle\"></div>\r\n                                </div>\r\n                                <img src={this.user.userAvatar} alt=\"\" className=\"cm-img-06 cm-as-fs\"/>\r\n                            </div>\r\n                        </div>\r\n                    }\r\n                </div>\r\n            );\r\n        };\r\n        return <div>\r\n            <Title title={this.item.anotherUserName||this.item.publishUserName}\r\n                   onLeftClick={this.onLeftClick.bind(this)}\r\n                   style={{background:\"#fff\"}}\r\n            />\r\n            <div className=\"detail-fixed-height\" onClick={()=>this.close()}>\r\n            <div className=\"cm-flex cm-jc-sb cm-p-018 detail-fixed\">\r\n            <div className=\"cm-flex cm-ai-c\">\r\n                {productImgs && productImgs[0]?\r\n                    <img src={productImgs[0]} alt=\"\" className=\"cm-img-12 cm-mr-018\"/>:\r\n                    <div className=\"cm-img-12 cm-mr-018 cm-c-999 cm-fs-026 cm-border-ddd cm-flex cm-ai-c cm-tx-c\">该商品已下架</div>\r\n                }\r\n                <div>\r\n                    <div className=\"cm-c-main cm-fs-028 cm-fw-bold\">￥123</div>\r\n                    <div className=\"cm-c-999 cm-fs-026 cm-mt-018\">交易前聊一聊</div>\r\n                </div>\r\n            </div>\r\n                {productImgs && productImgs[0]?\r\n                <div className=\"cm-btn-border-main cm-as-fe\">立即购买</div>:\r\n                    <div className=\"cm-btn-border-999 cm-as-fe\">立即购买</div>\r\n                }\r\n            </div>\r\n            </div>\r\n            <div onClick={()=>this.close()} ref=\"chatList\">\r\n                <ListView\r\n                    key={this.state.useBodyScroll ? '0' : '1'}\r\n                    ref={el => this.lv = el}\r\n                    dataSource={this.state.dataSource}\r\n                    renderRow={row}\r\n                    useBodyScroll={this.state.useBodyScroll}\r\n                    style={this.state.useBodyScroll ? {} : {\r\n                            height: this.state.height\r\n                        }}\r\n                    pullToRefresh={<PullToRefresh\r\n                        refreshing={this.state.refreshing}\r\n                        onRefresh={this.onRefresh}\r\n                    />}\r\n                    pageSize={this.state.pageSize}\r\n                />\r\n            </div>\r\n            {this.state.isShow?\r\n            <div className=\"cm-bottom-position\">\r\n                <textarea onChange={(e) => this.changeState(e)}\r\n                          onkeydown={(e)=>this.abc(e)}\r\n                          ref=\"textarea\"\r\n                          className=\"cm-border-ddd cm-border-radius-10 cm-mr-018 cm-flex-1 cm-p-009\" name=\"\"\r\n                          id=\"\" cols=\"30\" rows=\"2\" placeholder=\"想跟他说点什么呢？\"></textarea>\r\n                <span className=\"cm-btn-main cm-as-fe\"\r\n                      onClick={() => this.sendMessage()}>发送</span>\r\n            </div>:<div className=\"detail-height\">\r\n                    <div className=\"cm-bottom-position\">\r\n                        <input type=\"text\" placeholder=\"想跟他说点什么呢？\" className=\"cm-border-ddd cm-border-radius-10 cm-mr-018 cm-flex-1 cm-p-009\" onClick={(e) => this.openChat(e)}/>\r\n                        <span className=\"cm-btn-main\">发送</span>\r\n                    </div>\r\n                </div>}\r\n        </div>\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}