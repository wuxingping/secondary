{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\caoxue\\\\Desktop\\\\secondary\\\\src\\\\pages\\\\personal\\\\modifyInfo.js\";\n\n/**\r\n * Created by Lenovo on 2019/8/10.\r\n */\nimport React from 'react';\nimport './personal.css';\nimport { Title, List, Input, Button } from '../../share';\nimport { getData, goNext, checkParam } from '../../utils';\nconst Item = List.Item;\nexport default class ModifyInfo extends React.Component {\n  constructor(props) {\n    super(props); //获取本地缓存个人信息\n\n    let user = localStorage.getItem(\"userInfo\") ? JSON.parse(localStorage.getItem(\"userInfo\")) : {};\n    this.state = {\n      userAvatar: [user.userAvatar],\n      userName: user.userName\n    };\n  }\n\n  componentDidMount() {\n    this.uploadImg();\n  }\n\n  onLeftClick() {\n    this.props.history.goBack();\n  }\n\n  change(state) {\n    this.setState(state);\n  } //修改个人信息\n\n\n  modify() {\n    var arr = [{\n      value: this.state.userAvatar,\n      msg: \"请选择头像\"\n    }, {\n      value: this.state.userName,\n      msg: \"请输入用户名\"\n    }];\n    checkParam(arr, () => {\n      console.log(this.state.userAvatar);\n      var token = localStorage.getItem(\"token\");\n      let param = new FormData(); //创建form对象\n\n      param.append('userAvatar', this.state.userAvatar[0]); //通过append向form对象添加数据\n\n      param.append('userName', this.state.userName);\n      getData({\n        method: 'post',\n        url: 'updateUserInfo',\n        headers: {\n          'Content-Type': 'multipart/form-data',\n          'token': token\n        },\n        data: param,\n        successCB: res => {\n          //修改成功之后，替换掉本地缓存的头像和昵称，并进入个人中心页面\n          var user = JSON.parse(localStorage.getItem(\"userInfo\"));\n          user.userAvatar = this.state.userAvatar[0];\n          user.userName = this.state.userName;\n          localStorage.setItem(\"userInfo\", JSON.stringify(user));\n          goNext(this, 'personal');\n        }\n      });\n    });\n  } //选择个人头像\n\n\n  getAvatar(event) {\n    var files = event.target.files;\n    this.setState({\n      userAvatar: files\n    });\n\n    if (window.FileReader) {\n      var file = files[0];\n      var fr = new FileReader();\n      fr.readAsDataURL(file); //将图片作为url读出\n\n      fr.onloadend = e => {\n        this.refs.avatar.style.backgroundImage = \"url(\" + e.target.result + \")\";\n        this.refs.avatar.style.backgroundSize = \"100%\";\n      };\n    }\n\n    this.refs.avatar.setAttribute(\"class\", \"personal-again\");\n  } //反显个人头像\n\n\n  uploadImg(e) {\n    let user = localStorage.getItem(\"userInfo\");\n    user = localStorage.getItem(\"userInfo\") ? JSON.parse(localStorage.getItem(\"userInfo\")) : {};\n    this.refs.avatar.style.backgroundImage = \"url(\" + user.userAvatar + \")\";\n    this.refs.avatar.style.backgroundSize = \"100%\";\n    this.refs.avatar.setAttribute(\"class\", \"personal-again\");\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85\n      },\n      __self: this\n    }, React.createElement(Title, {\n      onLeftClick: () => this.onLeftClick(),\n      title: \"\\u7F16\\u8F91\\u4E2A\\u4EBA\\u4FE1\\u606F\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"cm-mt-036\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"personal-input-box\",\n      ref: \"avatar\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      type: \"file\",\n      className: \"personal-input\",\n      onChange: e => this.getAvatar(e),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89\n      },\n      __self: this\n    }))), React.createElement(\"div\", {\n      className: \"cm-m-018 cm-mt-018\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92\n      },\n      __self: this\n    }, React.createElement(List, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93\n      },\n      __self: this\n    }, React.createElement(Input, {\n      label: \"\\u6635\\u79F0\",\n      style: {\n        textAlign: \"right\"\n      },\n      maxLength: 16,\n      placeholder: \"\\u8BF7\\u8F93\\u5165\\u6635\\u79F0\",\n      defaultValue: this.state.userName,\n      onChange: val => this.change({\n        userName: val\n      }),\n      className: \"cm-c-999\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94\n      },\n      __self: this\n    })), React.createElement(Button, {\n      type: \"fill\",\n      className: \"cm-mt-080\",\n      onClick: () => this.modify(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104\n      },\n      __self: this\n    }, \"\\u786E\\u8BA4\\u4FEE\\u6539\")));\n  }\n\n}","map":{"version":3,"sources":["C:\\Users\\caoxue\\Desktop\\secondary\\src\\pages\\personal\\modifyInfo.js"],"names":["React","Title","List","Input","Button","getData","goNext","checkParam","Item","ModifyInfo","Component","constructor","props","user","localStorage","getItem","JSON","parse","state","userAvatar","userName","componentDidMount","uploadImg","onLeftClick","history","goBack","change","setState","modify","arr","value","msg","console","log","token","param","FormData","append","method","url","headers","data","successCB","res","setItem","stringify","getAvatar","event","files","target","window","FileReader","file","fr","readAsDataURL","onloadend","e","refs","avatar","style","backgroundImage","result","backgroundSize","setAttribute","render","textAlign","val"],"mappings":"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","sourcesContent":["/**\r\n * Created by Lenovo on 2019/8/10.\r\n */\r\nimport React from 'react';\r\nimport './personal.css';\r\nimport {Title,List,Input,Button} from '../../share';\r\nimport {getData, goNext,checkParam} from '../../utils';\r\nconst Item = List.Item;\r\nexport default class ModifyInfo extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        //获取本地缓存个人信息\r\n        let user = localStorage.getItem(\"userInfo\")?JSON.parse(localStorage.getItem(\"userInfo\")):{};\r\n        this.state = {\r\n            userAvatar:[user.userAvatar],\r\n            userName: user.userName,\r\n        }\r\n    }\r\n    componentDidMount(){\r\n       this.uploadImg();\r\n    }\r\n    onLeftClick(){\r\n        this.props.history.goBack();\r\n    }\r\n    change(state){\r\n        this.setState(state)\r\n    }\r\n    //修改个人信息\r\n    modify(){\r\n        var arr = [\r\n            {value:this.state.userAvatar,msg:\"请选择头像\"},\r\n            {value:this.state.userName,msg:\"请输入用户名\"},\r\n        ]\r\n        checkParam(arr,()=> {\r\n            console.log(this.state.userAvatar);\r\n            var token = localStorage.getItem(\"token\");\r\n            let param = new FormData(); //创建form对象\r\n            param.append('userAvatar',this.state.userAvatar[0]);//通过append向form对象添加数据\r\n            param.append('userName',this.state.userName);\r\n            getData({\r\n                method: 'post',\r\n                url: 'updateUserInfo',\r\n                headers:{\r\n                    'Content-Type':'multipart/form-data',\r\n                    'token':token\r\n                },\r\n                data: param,\r\n                successCB: (res) => {\r\n                    //修改成功之后，替换掉本地缓存的头像和昵称，并进入个人中心页面\r\n                    var user = JSON.parse(localStorage.getItem(\"userInfo\"));\r\n                    user.userAvatar = this.state.userAvatar[0];\r\n                    user.userName = this.state.userName;\r\n                    localStorage.setItem(\"userInfo\",JSON.stringify(user));\r\n                    goNext(this,'personal');\r\n                }\r\n            })\r\n        })\r\n    }\r\n    //选择个人头像\r\n    getAvatar(event){\r\n        var files = event.target.files;\r\n        this.setState({\r\n            userAvatar:files\r\n        });\r\n        if(window.FileReader) {\r\n            var file = files[0];\r\n            var fr = new FileReader();\r\n            fr.readAsDataURL(file);  //将图片作为url读出\r\n            fr.onloadend = (e)=> {\r\n                this.refs.avatar.style.backgroundImage  = \"url(\"+e.target.result+\")\";\r\n                this.refs.avatar.style.backgroundSize = \"100%\";\r\n            };\r\n        }\r\n        this.refs.avatar.setAttribute(\"class\",\"personal-again\");\r\n    }\r\n    //反显个人头像\r\n    uploadImg(e) {\r\n        let user = localStorage.getItem(\"userInfo\");\r\n        user = localStorage.getItem(\"userInfo\")?JSON.parse(localStorage.getItem(\"userInfo\")):{};\r\n        this.refs.avatar.style.backgroundImage  = \"url(\"+user.userAvatar+\")\";\r\n        this.refs.avatar.style.backgroundSize = \"100%\";\r\n        this.refs.avatar.setAttribute(\"class\",\"personal-again\");\r\n    }\r\n    render() {\r\n        return<div>\r\n            <Title  onLeftClick={()=>this.onLeftClick()} title=\"编辑个人信息\"/>\r\n            <div className=\"cm-mt-036\">\r\n                <div className=\"personal-input-box\" ref=\"avatar\">\r\n                    <input type=\"file\" className=\"personal-input\"  onChange={(e)=>this.getAvatar(e)}/>\r\n                </div>\r\n            </div>\r\n            <div className=\"cm-m-018 cm-mt-018\">\r\n                <List>\r\n                    <Input\r\n                        label=\"昵称\"\r\n                        style = {{textAlign:\"right\"}}\r\n                        maxLength={16}\r\n                        placeholder=\"请输入昵称\"\r\n                        defaultValue={this.state.userName}\r\n                        onChange={(val)=>this.change({userName:val})}\r\n                        className=\"cm-c-999\"\r\n                    />\r\n                </List>\r\n                <Button type=\"fill\" className=\"cm-mt-080\" onClick={() => this.modify()}>确认修改</Button>\r\n            </div>\r\n        </div>\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}