{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\caoxue\\\\Desktop\\\\secondary\\\\secondary\\\\src\\\\pages\\\\message\\\\messageDetail.js\";\n\n/**\r\n * Created by Lenovo on 2019/9/2.\r\n */\nimport React from 'react';\nimport './message.css';\nimport avatar from '../../images/personal/avatar.jpg';\nimport sale from '../../images/personal/sale.png';\nimport buy from '../../images/personal/buy.png';\nimport modify from '../../images/personal/modify.png';\nimport { Title } from '../../share';\nimport { getData, goNext, getTimeFormat } from '../../utils';\nexport default class MessageDetail extends React.Component {\n  constructor(props) {\n    super(props);\n    this.item = this.props.history.location.state || {};\n    console.log(this.item);\n    this.state = {\n      chatList: [],\n      index: 0\n    };\n  }\n\n  componentDidMount() {\n    this.goLogin();\n    var textarea = document.getElementsByTagName(\"textarea\");\n\n    for (var i = 0; i < textarea.length; i++) {\n      textarea[i].style.height = 'auto';\n      textarea[i].scrollTop = 0; //防抖动\n\n      textarea[i].style.height = textarea[i].scrollHeight + 'px';\n      textarea[i].addEventListener('input', function (e) {\n        e.target.style.height = 'auto';\n        e.target.scrollTop = 0; //防抖动\n\n        e.target.style.height = e.target.scrollHeight + 'px';\n      });\n    }\n  }\n\n  goLogin() {\n    getData({\n      method: 'post',\n      url: 'getChatList',\n      data: {},\n      successCB: res => {\n        console.log(res);\n      }\n    });\n  }\n\n  onLeftClick() {\n    this.props.history.push({\n      pathname: \"messageDetail\"\n    });\n  }\n\n  sendMessage() {\n    var user = JSON.parse(localStorage.getItem(\"userInfo\")) || {};\n    var userId = user.userId;\n    console.log(user);\n    var socket = new WebSocket(\"ws://49.232.24.206:9001/secondary/socket?\" + userId);\n    var value = this.refs.textarea.value;\n    this.state.chatList.push({\n      content: value\n    });\n    this.setState({\n      index: this.state.index++\n    });\n    var data = {\n      \"toUserId\": user.userId,\n      \"toUserName\": this.item.anotherUserName,\n      \"toUserAvatar\": this.item.anotherUserAvatar,\n      \"content\": value\n    };\n\n    socket.onopen = function () {\n      //heartCheck.reset().start(); //心跳检测重置\n      console.log(\"Socket 已打开\");\n    };\n\n    socket.onmessage = function (msg) {\n      console.log(msg);\n\n      if (msg.data.indexOf(\"{\") != -1) {\n        console.log(msg);\n        var obj = JSON.parse(msg.data);\n        console.log(obj);\n      }\n    };\n\n    if (socket.readyState === 1) {\n      socket.send(JSON.stringify(data));\n    } else {//do something\n    }\n\n    socket.onerror = function (err) {\n      console.log(err);\n    };\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89\n      },\n      __self: this\n    }, React.createElement(Title, {\n      title: this.item.anotherUserName,\n      onLeftClick: this.onLeftClick.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"cm-flex cm-ai-c cm-pad-10 cm-bc-white\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      src: this.item.anotherUserAvatar,\n      alt: \"\",\n      className: \"message-img-60 cm-mr-10\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"cm-c-main cm-fs-15\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94\n      },\n      __self: this\n    }, \"\\uFFE5123\"), React.createElement(\"div\", {\n      className: \"cm-c-999 cm-fs-12 cm-mt-10\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95\n      },\n      __self: this\n    }, \"\\u4EA4\\u6613\\u524D\\u804A\\u4E00\\u804A\"))), this.state.chatList.map((item, index) => {\n      return React.createElement(\"div\", {\n        className: \"cm-mar-10 cm-flex-column\",\n        key: index,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 99\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"cm-tx-c\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 100\n        },\n        __self: this\n      }, getTimeFormat(new Date().getTime())), React.createElement(\"div\", {\n        className: \"cm-flex cm-ai-c cm-tx-c cm-as-fe cm-mt-10 detail-ml-30\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"cm-flex\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 102\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \" detail-chat-height cm-plr-10 cm-bc-ddd cm-tx-l\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 103\n        },\n        __self: this\n      }, item.content), React.createElement(\"div\", {\n        className: \"detail-triangle\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104\n        },\n        __self: this\n      })), React.createElement(\"img\", {\n        src: this.item.anotherUserAvatar,\n        alt: \"\",\n        className: \"cm-img-large cm-as-fs\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106\n        },\n        __self: this\n      })));\n    }), React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"detail-position\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112\n      },\n      __self: this\n    }, React.createElement(\"textarea\", {\n      ref: \"textarea\",\n      className: \"detail-textarea\",\n      name: \"\",\n      id: \"\",\n      cols: \"30\",\n      rows: \"2\",\n      placeholder: \"\\u60F3\\u8DDF\\u4ED6\\u8BF4\\u70B9\\u4EC0\\u4E48\\u5462\\uFF1F\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"detail-send\",\n      onClick: () => this.sendMessage(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114\n      },\n      __self: this\n    }, \"\\u53D1\\u9001\")));\n  }\n\n}","map":{"version":3,"sources":["C:\\Users\\caoxue\\Desktop\\secondary\\secondary\\src\\pages\\message\\messageDetail.js"],"names":["React","avatar","sale","buy","modify","Title","getData","goNext","getTimeFormat","MessageDetail","Component","constructor","props","item","history","location","state","console","log","chatList","index","componentDidMount","goLogin","textarea","document","getElementsByTagName","i","length","style","height","scrollTop","scrollHeight","addEventListener","e","target","method","url","data","successCB","res","onLeftClick","push","pathname","sendMessage","user","JSON","parse","localStorage","getItem","userId","socket","WebSocket","value","refs","content","setState","anotherUserName","anotherUserAvatar","onopen","onmessage","msg","indexOf","obj","readyState","send","stringify","onerror","err","render","bind","map","Date","getTime"],"mappings":"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","sourcesContent":["/**\r\n * Created by Lenovo on 2019/9/2.\r\n */\r\nimport React from 'react';\r\nimport './message.css';\r\nimport avatar from '../../images/personal/avatar.jpg';\r\nimport sale from '../../images/personal/sale.png';\r\nimport buy from '../../images/personal/buy.png';\r\nimport modify from '../../images/personal/modify.png';\r\nimport {Title} from '../../share';\r\nimport {getData, goNext,getTimeFormat} from '../../utils';\r\nexport default class MessageDetail extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.item = this.props.history.location.state ||{};\r\n        console.log(this.item);\r\n        this.state = {\r\n            chatList:[],\r\n            index:0\r\n        }\r\n    }\r\n    componentDidMount(){\r\n        this.goLogin();\r\n        var textarea = document.getElementsByTagName(\"textarea\");\r\n        for(var i=0;i<textarea.length;i++){\r\n            textarea[i].style.height = 'auto';\r\n            textarea[i].scrollTop = 0; //防抖动\r\n            textarea[i].style.height = textarea[i].scrollHeight + 'px';\r\n            textarea[i].addEventListener('input',function (e) {\r\n                e.target.style.height = 'auto';\r\n                e.target.scrollTop = 0; //防抖动\r\n                e.target.style.height = e.target.scrollHeight + 'px';\r\n            })\r\n        }\r\n    }\r\n    goLogin(){\r\n        getData({\r\n            method: 'post',\r\n            url: 'getChatList',\r\n            data: {},\r\n            successCB: (res) => {\r\n                console.log(res);\r\n            }\r\n        })\r\n    }\r\n    onLeftClick(){\r\n        this.props.history.push({pathname:\"messageDetail\"});\r\n    }\r\n    sendMessage(){\r\n        var user = JSON.parse(localStorage.getItem(\"userInfo\"))||{};\r\n        var userId = user.userId;\r\n        console.log(user);\r\n        var socket = new WebSocket(\"ws://49.232.24.206:9001/secondary/socket?\" + userId);\r\n        var value = this.refs.textarea.value;\r\n        this.state.chatList.push({content:value});\r\n        this.setState({\r\n            index:this.state.index++\r\n        });\r\n        var data = {\r\n            \"toUserId\":user.userId,\r\n            \"toUserName\":this.item.anotherUserName,\r\n            \"toUserAvatar\":this.item.anotherUserAvatar,\r\n            \"content\": value,\r\n        };\r\n        socket.onopen = function() {\r\n            //heartCheck.reset().start(); //心跳检测重置\r\n            console.log(\"Socket 已打开\");\r\n        };\r\n        socket.onmessage = function(msg) {\r\n            console.log(msg);\r\n            if(msg.data.indexOf(\"{\") != -1) {\r\n                console.log(msg);\r\n                var obj = JSON.parse(msg.data);\r\n                console.log(obj);\r\n            }\r\n        };\r\n        if (socket.readyState===1) {\r\n            socket.send(JSON.stringify(data));\r\n        }else{\r\n            //do something\r\n        }\r\n\r\n        socket.onerror = function(err) {\r\n            console.log(err);\r\n        };\r\n\r\n    }\r\n    render() {\r\n        return <div>\r\n            <Title title={this.item.anotherUserName} onLeftClick={this.onLeftClick.bind(this)}/>\r\n               <div className=\"cm-flex cm-ai-c cm-pad-10 cm-bc-white\">\r\n                   <img src={this.item.anotherUserAvatar} alt=\"\" className=\"message-img-60 cm-mr-10\"/>\r\n                   <div>\r\n                       <div className=\"cm-c-main cm-fs-15\">￥123</div>\r\n                       <div className=\"cm-c-999 cm-fs-12 cm-mt-10\">交易前聊一聊</div>\r\n                   </div>\r\n               </div>\r\n            {this.state.chatList.map((item,index)=>{\r\n                return  <div className=\"cm-mar-10 cm-flex-column\" key={index}>\r\n                    <div className=\"cm-tx-c\">{getTimeFormat(new Date().getTime())}</div>\r\n                    <div className=\"cm-flex cm-ai-c cm-tx-c cm-as-fe cm-mt-10 detail-ml-30\">\r\n                        <div className=\"cm-flex\">\r\n                            <div className=\" detail-chat-height cm-plr-10 cm-bc-ddd cm-tx-l\">{item.content}</div>\r\n                            <div className=\"detail-triangle\"></div>\r\n                        </div>\r\n                        <img src={this.item.anotherUserAvatar} alt=\"\" className=\"cm-img-large cm-as-fs\"/>\r\n                    </div>\r\n                </div>\r\n            })}\r\n\r\n               <div></div>\r\n               <div className=\"detail-position\">\r\n                <textarea ref=\"textarea\" className=\"detail-textarea\" name=\"\" id=\"\" cols=\"30\" rows=\"2\" placeholder=\"想跟他说点什么呢？\"></textarea>\r\n                <div className=\"detail-send\" onClick={()=>this.sendMessage()}>发送</div>\r\n            </div>\r\n\r\n        </div>\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}